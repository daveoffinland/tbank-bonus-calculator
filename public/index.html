<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TBank Operations Team Bonus Calculator</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #1e3a8a;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .enhanced-slider::-webkit-slider-thumb {
            appearance: none;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: #07ad53;
            cursor: pointer;
            border: 3px solid #ffffff;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }
        .enhanced-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            background: #059642;
        }
        .enhanced-slider::-webkit-slider-track {
            background: #e5e7eb;
            height: 12px;
            border-radius: 6px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root">
        <div class="min-h-screen flex items-center justify-center">
            <div class="text-center">
                <div class="spinner mb-4"></div>
                <p class="text-gray-600">Loading TBank Bonus Calculator...</p>
            </div>
        </div>
    </div>

    <script>
        const { useState, useEffect } = React;
        const { 
            DollarSign, Users, TrendingUp, Settings, Lock, Save, 
            Eye, EyeOff, ChevronDown, ChevronUp, HelpCircle 
        } = lucide;

        function BonusCalculator() {
            // All your state variables
            const [positionLevel, setPositionLevel] = useState('');
            const [loanVolumeSlider, setLoanVolumeSlider] = useState(245000000);
            const [results, setResults] = useState(null);
            const [showAdmin, setShowAdmin] = useState(false);
            const [adminPassword, setAdminPassword] = useState('');
            const [isAdminAuthenticated, setIsAdminAuthenticated] = useState(false);
            const [showPassword, setShowPassword] = useState(false);
            const [savedRates, setSavedRates] = useState(null);
            const [showSaveConfirmation, setShowSaveConfirmation] = useState(false);
            const [showHowItWorks, setShowHowItWorks] = useState(false);
            const [errorMessage, setErrorMessage] = useState('');
            const [loading, setLoading] = useState(true);
            const [teamMembers, setTeamMembers] = useState({
                'Level I': 0,
                'Level II': 0,
                'Level III': 0
            });
            const [teamLoanVolume, setTeamLoanVolume] = useState(245000000);
            const [teamBonusResults, setTeamBonusResults] = useState(null);
            const [positionBonusRates, setPositionBonusRates] = useState({
                'Level I': 0.00005,
                'Level II': 0.000055,
                'Level III': 0.00006
            });

            const ADMIN_PASSWORD = 'admin2025';
            const BUDGET_THRESHOLD_1 = 200000000;
            const BUDGET_THRESHOLD_2 = 240000000;

            // Load rates from database
            useEffect(() => {
                fetch('/api/bonus-rates')
                    .then(response => response.json())
                    .then(data => {
                        setPositionBonusRates(data);
                        setSavedRates(data);
                        setLoading(false);
                    })
                    .catch(error => {
                        console.error('Error loading rates:', error);
                        setLoading(false);
                    });
            }, []);

            // Utility functions
            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 2
                }).format(amount);
            };

            const formatPercentage = (decimal) => {
                return (decimal * 100).toFixed(4) + '%';
            };

            // Calculate budget bonus
            const calculateBudgetBonus = (volume, positionRate) => {
                if (volume <= BUDGET_THRESHOLD_1) {
                    return { partA: 0, partB: 0, total: 0, qualified: false };
                }

                let partA = 0;
                let partB = 0;

                if (volume > BUDGET_THRESHOLD_1) {
                    const partAAmount = Math.min(volume - BUDGET_THRESHOLD_1, BUDGET_THRESHOLD_2 - BUDGET_THRESHOLD_1);
                    partA = partAAmount * positionRate;
                }

                if (volume > BUDGET_THRESHOLD_2) {
                    const partBAmount = volume - BUDGET_THRESHOLD_2;
                    partB = partBAmount * (positionRate * 2);
                }

                return { partA, partB, total: partA + partB, qualified: true };
            };

            // Main calculation
            const calculateBonus = () => {
                setErrorMessage('');
                
                if (!positionLevel) {
                    setErrorMessage('Please select a position level before calculating the bonus.');
                    return;
                }

                const volume = loanVolumeSlider;
                const positionRate = positionBonusRates[positionLevel];
                const baseBonus = volume * positionRate;
                const budgetBonusCalc = calculateBudgetBonus(volume, positionRate);
                const totalBonus = baseBonus + budgetBonusCalc.total;

                setResults({
                    positionLevel,
                    loanVolume: volume,
                    baseBonus,
                    budgetBonus: budgetBonusCalc,
                    totalBonus
                });
            };

            // Admin functions
            const handleAdminLogin = () => {
                if (adminPassword === ADMIN_PASSWORD) {
                    setIsAdminAuthenticated(true);
                    setAdminPassword('');
                } else {
                    alert('Incorrect password');
                    setAdminPassword('');
                }
            };

            const saveRates = async () => {
                try {
                    const response = await fetch('/api/bonus-rates', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ rates: positionBonusRates }),
                    });

                    if (response.ok) {
                        setSavedRates({ ...positionBonusRates });
                        setShowSaveConfirmation(true);
                        setTimeout(() => setShowSaveConfirmation(false), 3000);
                    }
                } catch (error) {
                    console.error('Error saving rates:', error);
                }
            };

            const updateBonusRate = (level, newRate) => {
                const rateAsDecimal = parseFloat(newRate) / 100;
                if (!isNaN(rateAsDecimal) && rateAsDecimal >= 0) {
                    setPositionBonusRates(prev => ({ ...prev, [level]: rateAsDecimal }));
                }
            };

            const hasUnsavedChanges = () => {
                if (!savedRates) return true;
                return JSON.stringify(positionBonusRates) !== JSON.stringify(savedRates);
            };

            const handleSliderChange = (value) => {
                setLoanVolumeSlider(value);
            };

            const reset = () => {
                setPositionLevel('');
                setLoanVolumeSlider(245000000);
                setResults(null);
                setErrorMessage('');
            };

            if (loading) {
                return React.createElement('div', { className: 'min-h-screen flex items-center justify-center' },
                    React.createElement('div', { className: 'text-center' },
                        React.createElement('div', { className: 'spinner mb-4' }),
                        React.createElement('p', { className: 'text-gray-600' }, 'Loading...')
                    )
                );
            }

            return React.createElement('div', { className: 'max-w-4xl mx-auto p-6 bg-gray-50 min-h-screen' },
                React.createElement('div', { className: 'bg-white rounded-lg shadow-lg p-8' },
                    // Header
                    React.createElement('div', { className: 'flex items-center justify-between mb-8' },
                        React.createElement('div', { className: 'flex items-center' },
                            React.createElement('div', { className: 'bg-blue-900 px-4 py-2 rounded mr-4' },
                                React.createElement('span', { className: 'text-white font-bold text-2xl' }, 'TBank')
                            ),
                            React.createElement('h1', { className: 'text-3xl font-bold text-gray-800' }, 'Operations Team Bonus Calculator')
                        ),
                        React.createElement('button', {
                            onClick: () => setShowAdmin(!showAdmin),
                            className: 'flex items-center px-4 py-2 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition duration-200'
                        },
                            React.createElement(Settings, { className: 'h-4 w-4 mr-2' }),
                            'Admin'
                        )
                    ),

                    // Main content
                    React.createElement('div', { className: 'grid md:grid-cols-2 gap-8' },
                        // Left column - Calculator
                        React.createElement('div', { className: 'space-y-6' },
                            React.createElement('h2', { className: 'text-xl font-semibold text-gray-700 mb-4' }, 'Calculation Information'),
                            
                            // Position Level
                            React.createElement('div', null,
                                React.createElement('label', { className: 'block text-sm font-medium text-gray-600 mb-2' },
                                    'Position Level ',
                                    React.createElement('span', { className: 'text-red-500' }, '*')
                                ),
                                React.createElement('select', {
                                    value: positionLevel,
                                    onChange: (e) => setPositionLevel(e.target.value),
                                    className: 'w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent'
                                },
                                    React.createElement('option', { value: '' }, 'Select Position Level'),
                                    React.createElement('option', { value: 'Level I' }, 'Level I'),
                                    React.createElement('option', { value: 'Level II' }, 'Level II'),
                                    React.createElement('option', { value: 'Level III' }, 'Level III')
                                )
                            ),

                            // Slider
                            React.createElement('div', null,
                                React.createElement('label', { className: 'block text-sm font-medium text-gray-600 mb-2' },
                                    'Total Loan Origination Volume ',
                                    React.createElement('span', { className: 'text-red-500' }, '*')
                                ),
                                React.createElement('div', { className: 'space-y-3' },
                                    React.createElement('div', { className: 'text-center' },
                                        React.createElement('span', { className: 'font-medium text-gray-700 text-lg' }, formatCurrency(loanVolumeSlider))
                                    ),
                                    React.createElement('div', { className: 'flex justify-center items-center space-x-3' },
                                        React.createElement('button', {
                                            onClick: () => handleSliderChange(Math.max(0, loanVolumeSlider - 10000000)),
                                            className: 'px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded text-sm font-medium'
                                        }, '-$10M'),
                                        React.createElement('button', {
                                            onClick: () => handleSliderChange(Math.max(0, loanVolumeSlider - 1000000)),
                                            className: 'px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded text-sm font-medium'
                                        }, '-$1M'),
                                        React.createElement('button', {
                                            onClick: () => handleSliderChange(Math.min(500000000, loanVolumeSlider + 1000000)),
                                            className: 'px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded text-sm font-medium'
                                        }, '+$1M'),
                                        React.createElement('button', {
                                            onClick: () => handleSliderChange(Math.min(500000000, loanVolumeSlider + 10000000)),
                                            className: 'px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded text-sm font-medium'
                                        }, '+$10M')
                                    ),
                                    React.createElement('input', {
                                        type: 'range',
                                        min: '0',
                                        max: '500000000',
                                        step: '1000000',
                                        value: loanVolumeSlider,
                                        onChange: (e) => handleSliderChange(parseInt(e.target.value)),
                                        className: 'w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer enhanced-slider'
                                    }),
                                    React.createElement('div', { className: 'flex justify-between text-xs text-gray-400' },
                                        React.createElement('span', null, '$0'),
                                        React.createElement('span', null, '$500M')
                                    ),
                                    React.createElement('div', { className: 'text-center' },
                                        React.createElement('span', { 
                                            className: `inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${
                                                loanVolumeSlider >= 240000000 ? 'bg-green-100 text-green-800' : 
                                                loanVolumeSlider >= 200000000 ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-600'
                                            }`
                                        },
                                            loanVolumeSlider >= 240000000 ? '✓ Tier 2 Budget Bonus Qualified' : 
                                            loanVolumeSlider >= 200000000 ? '✓ Tier 1 Budget Bonus Qualified' : '○ Budget Bonus Not Qualified'
                                        )
                                    )
                                )
                            ),

                            // Error message
                            errorMessage && React.createElement('div', { className: 'bg-red-50 border border-red-200 rounded-lg p-3' },
                                React.createElement('p', { className: 'text-red-700 text-sm font-medium' }, errorMessage)
                            ),

                            // Buttons
                            React.createElement('div', { className: 'flex space-x-4' },
                                React.createElement('button', {
                                    onClick: calculateBonus,
                                    className: 'flex-1 bg-blue-900 text-white py-2 px-4 rounded-lg hover:bg-blue-800 transition duration-200 font-medium'
                                }, 'Calculate Bonus'),
                                React.createElement('button', {
                                    onClick: reset,
                                    className: 'px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-200 font-medium'
                                }, 'Reset')
                            )
                        ),

                        // Right column - Results
                        React.createElement('div', null,
                            results ? React.createElement('div', { className: 'bg-gradient-to-br from-blue-50 to-green-50 rounded-lg p-6 border border-blue-200' },
                                React.createElement('h2', { className: 'text-xl font-semibold text-gray-800 mb-4 flex items-center' },
                                    React.createElement(TrendingUp, { className: 'h-5 w-5 mr-2' }),
                                    'Bonus Calculation Results'
                                ),
                                React.createElement('div', { className: 'space-y-4' },
                                    React.createElement('div', { className: 'bg-white rounded-lg p-4 shadow-sm' },
                                        React.createElement('h3', { className: 'font-medium text-gray-700 mb-2' }, 'Calculation Details'),
                                        React.createElement('div', { className: 'text-sm text-gray-600 space-y-1' },
                                            React.createElement('p', null, 
                                                React.createElement('span', { className: 'font-medium' }, 'Position Level: '),
                                                results.positionLevel
                                            ),
                                            React.createElement('p', null,
                                                React.createElement('span', { className: 'font-medium' }, 'Loan Volume: '),
                                                formatCurrency(results.loanVolume)
                                            )
                                        )
                                    ),
                                    React.createElement('div', { className: 'bg-white rounded-lg p-4 shadow-sm' },
                                        React.createElement('h3', { className: 'font-medium text-gray-700 mb-3' }, 'Bonus Breakdown'),
                                        React.createElement('div', { className: 'space-y-2' },
                                            React.createElement('div', { className: 'flex justify-between' },
                                                React.createElement('span', { className: 'text-gray-600' }, 'Base Bonus (Annual Total):'),
                                                React.createElement('span', { className: 'font-medium text-blue-600' }, formatCurrency(results.baseBonus))
                                            ),
                                            React.createElement('div', { className: 'flex justify-between' },
                                                React.createElement('span', { className: 'text-gray-600 ml-4' }, 'Base Bonus (Quarterly Amount):'),
                                                React.createElement('span', { className: 'font-medium text-blue-500' }, formatCurrency(results.baseBonus / 4))
                                            ),
                                            results.budgetBonus.qualified && React.createElement('div', { className: 'bg-green-50 rounded p-3 mt-2' },
                                                React.createElement('div', { className: 'flex justify-between mb-1' },
                                                    React.createElement('span', { className: 'text-green-700 font-medium' }, 'Budget Bonus (Qualified!):'),
                                                    React.createElement('span', { className: 'font-medium text-green-600' }, formatCurrency(results.budgetBonus.total))
                                                )
                                            ),
                                            React.createElement('hr', { className: 'my-2' }),
                                            React.createElement('div', { className: 'flex justify-between text-lg' },
                                                React.createElement('span', { className: 'font-semibold text-gray-800' }, 'Total Bonus:'),
                                                React.createElement('span', { className: 'font-bold text-green-700' }, formatCurrency(results.totalBonus))
                                            )
                                        )
                                    )
                                )
                            ) : React.createElement('div', { className: 'bg-gray-50 rounded-lg p-8 border-2 border-dashed border-gray-300 text-center' },
                                React.createElement(Users, { className: 'h-16 w-16 text-gray-400 mx-auto mb-4' }),
                                React.createElement('h3', { className: 'text-lg font-medium text-gray-600 mb-2' }, 'Ready to Calculate'),
                                React.createElement('p', { className: 'text-gray-500' }, 'Select position level and loan volume, then click "Calculate Bonus" to see the results.')
                            )
                        )
                    )
                )
            );
        }

        // Render the app
        ReactDOM.render(React.createElement(BonusCalculator), document.getElementById('root'));
    </script>
</body>
</html>
